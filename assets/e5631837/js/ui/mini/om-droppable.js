(function(e,t){e.omWidget("om.omDroppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,greedy:!1,hoverClass:!1,_scope:"default"},_create:function(){var t=this.options,n=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.om.ddmanager.droppables[t._scope]=e.om.ddmanager.droppables[t._scope]||[],e.om.ddmanager.droppables[t._scope].push(this),this.element.addClass("om-droppable")},destroy:function(){var t=e.om.ddmanager.droppables[this.options._scope];for(var n=0;n<t.length;n++)t[n]==this&&t.splice(n,1);return this.element.removeClass("om-droppable om-droppable-disabled").removeData("omDroppable").unbind(".droppable"),this},_setOption:function(t,n){t=="accept"&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.OMWidget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.om.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("onDragStart",t,n.currentItem||n.element)},_deactivate:function(t){var n=e.om.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_over:function(t){var n=e.om.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("onDragOver",t,n.currentItem||n.element))},_out:function(t){var n=e.om.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("onDragOut",t,n.currentItem||n.element))},_drop:function(t,n){var r=n||e.om.ddmanager.current;if(!r||(r.currentItem||r.element)[0]==this.element[0])return!1;var i=!1;return this.element.find(":data(omDroppable)").not(".om-draggable-dragging").each(function(){var t=e.data(this,"omDroppable");if(t.options.greedy&&!t.options.disabled&&t.options._scope==r.options._scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.om.intersect(r,e.extend(t,{offset:t.element.offset()})))return i=!0,!1}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("onDrop",t,r.currentItem||r.element),this.element):!1}}),e.om.intersect=function(e,t){if(!t.offset)return!1;var n=(e.positionAbs||e.position.absolute).left,r=n+e.helperProportions.width,i=(e.positionAbs||e.position.absolute).top,s=i+e.helperProportions.height,o=t.offset.left,u=o+t.proportions.width,a=t.offset.top,f=a+t.proportions.height;return o<n+e.helperProportions.width/2&&r-e.helperProportions.width/2<u&&a<i+e.helperProportions.height/2&&s-e.helperProportions.height/2<f},e.om.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r=e.om.ddmanager.droppables[t.options._scope]||[],i=n?n.type:null,s=(t.currentItem||t.element).find(":data(omDroppable)").andSelf();e:for(var o=0;o<r.length;o++){if(r[o].options.disabled||t&&!r[o].accept.call(r[o].element[0],t.currentItem||t.element))continue;for(var u=0;u<s.length;u++)if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e}r[o].visible=r[o].element.css("display")!="none";if(!r[o].visible)continue;i=="mousedown"&&r[o]._activate.call(r[o],n),r[o].offset=r[o].element.offset(),r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight}}},drop:function(t,n){var r=!1;return e.each(e.om.ddmanager.droppables[t.options._scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&e.om.intersect(t,this)&&(r=r||this._drop.call(this,n)),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,n))}),r},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.om.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.om.ddmanager.prepareOffsets(t,n),e.each(e.om.ddmanager.droppables[t.options._scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var r=e.om.intersect(t,this),i=!r&&this.isover==1?"isout":r&&this.isover==0?"isover":null;if(!i)return;var s;if(this.options.greedy){var o=this.element.parents(":data(omDroppable):eq(0)");o.length&&(s=e.data(o[0],"omDroppable"),s.greedyChild=i=="isover"?1:0)}s&&i=="isover"&&(s.isover=0,s.isout=1,s._out.call(s,n)),this[i]=1,this[i=="isout"?"isover":"isout"]=0,this[i=="isover"?"_over":"_out"].call(this,n),s&&i=="isout"&&(s.isout=0,s.isover=1,s._over.call(s,n))})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.om.ddmanager.prepareOffsets(t,n)}}})(jQuery);