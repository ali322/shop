(function(e){e.omWidget("om.omTooltip",{options:{width:"auto",minWidth:null,maxWidth:null,height:"auto",maxHeight:null,minHeight:null,delay:300,anchor:!1,trackMouse:!1,showOn:"mouseover",lazyLoad:!1,url:null,offset:[5,5],anchorOffset:0,region:null,html:null,contentEL:null},_create:function(){this.tipContent=e('<div class="tip-body"></div>'),this.tipAnchor=e('<div class="tip-anchor"></div>'),this.regionMap={right:"left",top:"bottom",left:"right",bottom:"top"},this.tip=e('<div class="tip"></div>').append(this.tipContent)},_init:function(){var t=this,n=t.options;this.tipContent.empty(),this.tip.find("div.tip-anchor").remove(),n.anchor&&t.tip.append(t.tipAnchor),t.adjustWidth=6,t.adjustHeight=6,n.width!="auto"?this.tip.css("width",n.width-t.adjustWidth):this.tip.css("width","auto"),n.height!="auto"?this.tip.css("height",n.height-t.adjustHeight):this.tip.css("height","auto"),n.minWidth&&this.tip.css("minWidth",n.minWidth-t.adjustWidth),n.maxWidth&&this.tip.css("maxWidth",n.maxWidth-t.adjustWidth),n.maxHeight&&this.tip.css("maxHeight",n.maxHeight-t.adjustHeight),n.minHeight&&this.tip.css("minHeight",n.minHeight-t.adjustHeight);if(n.url&&!n.lazyLoad)t._ajaxLoad(n.url);else if(n.html)this.tip.find(".tip-body").append(n.html);else{var r=e(n.contentEL).clone();e(n.contentEL).remove(),this.tip.find(".tip-body").append(r.show())}this._bindEvent()},_ajaxLoad:function(t){var n=this;e.ajax({url:t,method:"POST",dataType:"html",success:function(e,t){n.tip.find(".tip-body").append(e)},error:function(t,r,i){n.tip.find(".tip-body").append(e.om.lang.omTooltip.FailedToLoad)}})},_bindEvent:function(){var e=this,t=e.options,n=e.element;t.showOn=="mouseover"?n.bind("mouseover.tooltip",function(n){e.showTime&&clearTimeout(e.showTime),e.showTime=setTimeout(function(){e.show(n)},t.delay)}):t.showOn=="click"&&(e.showTime=n.bind("click.tooltip",function(n){setTimeout(function(){e.show(n)},t.delay)})),t.trackMouse&&n.bind("mousemove.tooltip",function(t){e._adjustPosition(t)}),n.bind("mouseleave.tooltip",function(){e.showTime&&clearTimeout(e.showTime),e.hideTime=setTimeout(function(){e.hide()},t.delay)}),e.tip.bind("mouseover.tooltip",function(){e.hideTime&&clearTimeout(e.hideTime)}).bind("mouseleave.tooltip",function(){setTimeout(function(){e.hide()},t.delay)})},show:function(t){var n=this,r=n.options;e(document.body).find(n.tip).length<=0?(r.url&&r.lazyLoad&&n._ajaxLoad(r.url),n.tip.appendTo(document.body).fadeIn(),n._adjustPosition(t)):(n._adjustPosition(t),n.tip.fadeIn())},_adjustPosition:function(t){var n=this,r=n.options,i=n.element,s,o,u=e(i).offset();if(t&&!r.region)s=t.pageY+r.offset[0],o=t.pageX+r.offset[1],n.tip.find(".tip-anchor").css({top:r.anchorOffset+3,left:"-9px"}).addClass("tip-anchor-left");else{var a=parseInt(e(i).css("borderBottomWidth").replace("px",""));s=u.top+e(i).height()+(isNaN(a)?0:a)+r.offset[0],o=u.left+r.offset[1],r.region=="right"?(o=u.left+r.offset[1]+e(i).width()+n.adjustWidth,s=s-n.element.height()+n.adjustHeight+r.offset[0],n.tip.find(".tip-anchor").css({top:r.anchorOffset+3,left:"-9px"})):r.region=="left"?(o=u.left-n.tip.width()-n.adjustWidth-r.offset[1]-2,s=s-n.element.height()-n.adjustHeight-r.offset[0],n.tip.find(".tip-anchor").css({top:r.anchorOffset+3,left:n.tip.outerWidth()-2})):r.region=="top"?(s=s-(n.element.height()+n.tip.height()+n.adjustHeight+2)-r.offset[0],o+=r.offset[1],n.tip.find(".tip-anchor").css({top:n.tip.outerHeight()-3,left:r.anchorOffset+3})):r.region=="bottom"&&(s+=r.offset[0],o+=r.offset[1],n.tip.find(".tip-anchor").css({top:-9,left:r.anchorOffset+3})),n.tip.find(".tip-anchor").addClass("tip-anchor-"+n.regionMap[r.region])}o+n.tip.width()>document.documentElement.clientWidth&&(o=o-n.tip.width()-20),s+n.tip.height()>document.documentElement.clientHeight&&(s=s-(n.element.height()+n.tip.height())-20),n.tip.css({top:s-e(document).scrollTop(),left:o-e(document).scrollLeft()})},hide:function(){this.tip.hide()},destroy:function(){clearTimeout(this.showTime),clearTimeout(this.hideTime),this.element.unbind(".tooltip"),this.tip.remove()}}),e.om.lang.omTooltip={FailedToLoad:"加载提示信息出错！"}})(jQuery);