(function(e){var t=["collapse","min","max","close"],n=["om-panel-tool-collapse","om-panel-tool-expand","om-panel-tool-min","om-panel-tool-max","om-panel-tool-close"],r={anim:!0,speed:"fast"};e.omWidget("om.omPanel",{options:{title:"",width:"auto",height:"auto",header:!0,collapsible:!1,closable:!1,closed:!1,collapsed:!1,tools:[],loadingMessage:"default",_closeMode:"hidden",_helpMsg:!1},_create:function(){this.element.addClass("om-panel-body om-widget-content").wrap("<div class='om-widget om-panel'></div>")},_init:function(){var e=this.options,t=this.element,n=t.parent(),r;this._renderHeader(),r=t.prev(),e.header===!1&&t.addClass("om-panel-noheader"),this._bindEvent(),this._resize(n);var i=e.header!==!1?r.outerHeight():0;e.collapsed!==!1?("auto"!==e.height&&n.height(i),t.hide(),e.header!==!1&&r.find(">.om-panel-tool >.om-panel-tool-collapse").removeClass("om-panel-tool-collapse").addClass("om-panel-tool-expand")):(t.show(),e.header!==!1&&r.find(">.om-panel-tool >.om-panel-tool-expand").removeClass("om-panel-tool-expand").addClass("om-panel-tool-collapse")),e.closed!==!1?this._hide(n):this._show(n),this.reload()},_hide:function(e){"hidden"===this.options._closeMode?e.hide():"visibility"===this.options._closeMode&&e.addClass("om-helper-hidden-accessible")},_show:function(e){"hidden"===this.options._closeMode?e.show():"visibility"===this.options._closeMode&&e.removeClass("om-helper-hidden-accessible")},_bindEvent:function(){var t=this,n=this.element,r=this.options,i=n.prev();r.collapsible!==!1&&i.click(function(n){e(n.target).is(".om-panel-icon,.om-panel-title,.om-panel-header")&&(r.collapsed!==!1?t.expand():t.collapse())}).find(".om-panel-tool-collapse , .om-panel-tool-expand").click(function(){r.collapsed!==!1?t.expand():t.collapse()}),r.closable!==!1&&i.find(".om-panel-tool-close").click(function(e){t.close()})},_renderHeader:function(){this.header&&this.header.remove();if(this.options.header===!1)return;var t=this,r=this.options,i=r.tools,s=this.header=e("<div class='om-panel-header'></div>").insertBefore(this.element);r._helpMsg&&s.parent().addClass("helpMsg"),r.iconCls&&e("<div class='om-icon om-panel-icon'></div>").addClass(r.iconCls).appendTo(s),e("<div class='om-panel-title'></div>").html(r.title).appendTo(s),$tool=e("<div class='om-panel-tool'></div>"),r.collapsible!==!1&&e("<div class='om-icon om-panel-tool-collapse'></div>").appendTo($tool);if(e.isArray(i))for(var o=0,u=i.length;o<u;o++){var a=i[o],f;(f=this._getInnerToolCls(a.id))?e("<div class='om-icon'></div>").addClass(f).click(function(e){a.handler.call(this,t,e)}).appendTo($tool):typeof a.iconCls=="string"?e("<div class='om-icon'></div>").addClass(a.iconCls).click(function(e){a.handler.call(this,t,e)}).appendTo($tool):e.isArray(a.iconCls)&&function(n){e("<div class='om-icon'></div>").addClass(n.iconCls[0]).click(function(e){n.handler.call(this,t,e)}).hover(function(){n.iconCls[1]&&e(this).toggleClass(n.iconCls[1])}).appendTo($tool)}(a)}else try{e(i).appendTo($tool)}catch(l){throw"bad format of jquery selector."}r.closable!==!1&&e("<div class='om-icon om-panel-tool-close'></div>").appendTo($tool),$tool.find(">div.om-icon").hover(function(){var t=this;e.each(n,function(){e(t).hasClass(this)&&e(t).toggleClass(this+"-hover")})}),$tool.appendTo(s)},_resize:function(e){var t=this.element,n=t.prev(),e=t.parent(),r=this.options;if(r.width=="fit")r.width="100%",e.width("100%"),n.css("width",""),t.css("width","");else if(r.width!=="auto")e.width(r.width),n.outerWidth(e.width()),t.outerWidth(e.width());else{var i=t.attr("style");i&&i.indexOf("width")!==-1?(e.width(t.outerWidth()),n.outerWidth(t.outerWidth())):(e.css("width",""),n.css("width",""),t.css("width",""))}if(r.height=="fit")r.height="100%",e.height("100%"),r.header==0?t.height("100%"):t.outerHeight(e.height()-(this.options.header!==!1?n.outerHeight():0));else if(r.height!=="auto")e.height(r.height),t.outerHeight(e.height()-(this.options.header!==!1?n.outerHeight():0));else{var i=t.attr("style");i&&i.indexOf("height")!==-1?e.height(n.outerHeight()+t.outerHeight()):(e.css("height",""),t.css("height",""))}},_getInnerToolCls:function(n){return e.inArray(n,t)!=-1?"om-panel-tool-"+n:null},_showLoadingMessage:function(){var t=this.options,n=this.element,r=n.next(".om-panel-loadingMessage"),i={width:n.innerWidth(),height:n.innerHeight(),left:n.position().left+parseInt(n.css("border-left-width")),top:n.position().top};r.length===0?"default"===t.loadingMessage?e("<div class='om-panel-loadingMessage'><div class='valignMiddle'><div class='loadingImg'>数据加载中</div></div></div>").css(i).appendTo(n.parent()):e("<div class='om-panel-loadingMessage'></div>").appendTo(n.parent()).html(t.loadingMessage).css(i):r.css(i).show()},_hideLoadingMessage:function(){this.element.parent().find(".om-panel-loadingMessage").hide()},setTitle:function(e){this.element.prev().find(">.om-panel-title").html(e)},setIconClass:function(t){var n=this.element.prev(),r=n.find(">.om-panel-icon");t==null&&r.length!==0?r.remove():(r.length==0&&(r=e("<div class='om-icon om-panel-icon'></div>").insertBefore(n.find(">.om-panel-title"))),this.options.iconCls&&r.removeClass(this.options.iconCls),r.addClass(t),this.options.iconCls=t)},open:function(){var e=this.element,t=this.options;if(t.closed){if(t.onBeforeOpen&&this._trigger("onBeforeOpen")===!1)return;this._show(e.parent()),t.closed=!1,t.onOpen&&this._trigger("onOpen")}},close:function(){var e=this.element,t=this.options;if(!t.closed){if(t.onBeforeClose&&this._trigger("onBeforeClose")===!1)return;this._hide(e.parent()),t.closed=!0,t.onClose&&this._trigger("onClose")}},reload:function(t){var n=this.options,r=this.element,i=this;if(r.data("loading"))return;r.data("loading",!0),t=t||n.url;if(!t){r.data("loading",!1);return}n.url=t,this._showLoadingMessage(),e.ajax(t,{cache:!1,success:function(e,t,s){r.html(n.preProcess?n.preProcess.call(r[0],e,t):e),r.data("loading",!1),i._hideLoadingMessage(),n.onSuccess&&i._trigger("onSuccess",null,e,t,s)},error:function(e,t,s){r.data("loading",!1),i._hideLoadingMessage(),n.onError&&i._trigger("onError",null,e,t,s)}})},resize:function(t){var n=this.options,r,i;e.isPlainObject(t)?(r=t.width||null,i=t.height||null):(r=arguments[0],i=arguments[1]),n.width=r||n.width,n.height=i||n.height,this._resize(this.element.parent())},collapse:function(){var e=this,t=this.element,n=t.prev(),i=t.parent(),s=t.next(".om-panel-loadingMessage"),o=this.options,u=r.anim,a=r.speed;arguments[0]!=undefined&&(u=arguments[0]),a=arguments[1]||a;if(o.onBeforeCollapse&&e._trigger("onBeforeCollapse")===!1)return;i.stop(!0,!0);if(n.length!==0){var f=n.find("> .om-panel-tool > div.om-panel-tool-collapse");f.length!==0&&(f.removeClass("om-panel-tool-collapse").addClass("om-panel-tool-expand"),f.hasClass("om-panel-tool-collapse-hover")&&f.toggleClass("om-panel-tool-collapse-hover om-panel-tool-expand-hover"))}i.animate({height:"-="+t.outerHeight()},u?a||"normal":0,function(){t.hide(),s.hide(),"auto"===o.height&&i.css("height",""),o.onCollapse&&e._trigger("onCollapse")}),o.collapsed=!0},expand:function(){var e=this,t=this.element,n=t.prev(),i=t.parent(),s=t.next(".om-panel-loadingMessage"),o=this.options,u=r.anim,a=r.speed;arguments[0]!=undefined&&(u=arguments[0]),a=arguments[1]||a;if(o.onBeforeExpand&&e._trigger("onBeforeExpand")===!1)return;i.stop(!0,!0);if(n.length!==0){var f=n.find("> .om-panel-tool > div.om-panel-tool-expand");f.length!==0&&(f.removeClass("om-panel-tool-expand").addClass("om-panel-tool-collapse"),f.hasClass("om-panel-tool-expand-hover")&&f.toggleClass("om-panel-tool-expand-hover om-panel-tool-collapse-hover"))}"auto"===o.height&&i.height(n.outerHeight()),t.show(),t.data("loading")&&s.show(),i.animate({height:"+="+t.outerHeight()},u?a||"normal":0,function(){"auto"===o.height&&i.css("height",""),o.onExpand&&e._trigger("onExpand")}),o.collapsed=!1},destroy:function(){var e=this.element;e.parent().after(e).remove()}})})(jQuery);