(function(){function i(e,t){return t.content&&$(e).html(t.content),$(e).omPanel(t)}function s(){return $.browser.msie&&parseInt($.browser.version)==7}var e="om-tabs-"+((1+Math.random())*65536|0).toString(16).substring(1)+"-",t=0,n="om-tabs-activated om-state-active",r="om-tabs-scroll-disabled";$.omWidget("om.omTabs",{options:{width:"auto",height:"auto",border:!0,tabWidth:"auto",tabHeight:27,scrollable:!0,closable:!1,position:"top",switchMode:"click",autoPlay:!1,interval:1e3,active:0,lazyLoad:!1,tabMenu:!1,onBeforeActivate:function(e,t){},onActivate:function(e,t){},onBeforeClose:function(e,t){},onClose:function(e,t){},onBeforeCloseAll:function(e){},onCloseAll:function(){},onAdd:function(e,t){},onBeforeAdd:function(e,t){},onLoadComplete:function(e,t){}},add:function(e){this._add(e)},close:function(e){this._close(e)},closeAll:function(){this._closeAll()},activate:function(e){this._activate(e)},getAlter:function(e){return this._getAlter(e)},getActivated:function(){return this._getActivated()},getLength:function(){return this._getLength()},setDataSource:function(e){if(e.index===undefined||!e.url&&!e.content)return;this._setDataSource(e)},reload:function(e,t,n){this._reload(e,t,n)},doLayout:function(){this._doLayout()},_create:function(){this._makeSketch(),this._collectItems(),this.history=[]},_init:function(){this._render(),this._afterRender(),this._buildEvent()},_makeSketch:function(){this.element.addClass("om-tabs om-widget om-widget-content om-corner-all").append('<div class="om-tabs-panels om-widget-content om-corner-bottom" />').find(">ul").wrap('<div class="om-tabs-headers om-helper-reset om-helper-clearfix om-widget-header om-corner-all" />'),this.$menu=$("<div></div>").appendTo($("body"))},_collectItems:function(){var n=this,r=this.element,s=this.options,o=[],u=[];r.find(">div.om-tabs-headers a").each(function(){var a=this.getAttribute("href",2),f=a.split("#")[0],l;f&&(f===location.toString().split("#")[0]||(l=$("base")[0])&&f===l.href)&&(a=this.hash,this.href=a);var c=$(this),h=c.attr("tabId")||c.attr("id")||e+t++;c.attr("tabId",h);var p={tabId:h,title:c.text(),_closeMode:"visibility",header:!1,height:"fit",closed:!0,onSuccess:function(e,t,r){n._trigger("onLoadComplete",null,p.tabId)},onError:function(e,t,r){n._trigger("onLoadComplete",null,p.tabId)}},d=$(">"+a,r)[0];!d&&a.indexOf("#")!=0&&(s.lazyLoad===!1?p.url=a:u.push({tabId:h,url:a,loaded:!1}));var v=new i(d||$("<div></div>")[0],p);o.push(v)}),$lis=r.find(">div.om-tabs-headers ul li"),$('<span class="left-placeholder"></span>').insertBefore($lis.eq(0)),$('<span class="right-placeholder"></span>').insertAfter($lis.eq($lis.length-1)),u.length>0&&(this.loadInfo=u),this.items=o},_render:function(){var e=this,t=this.element,n=this.options,r=this.items,i=t.find(">div.om-tabs-headers");typeof n.active=="number"&&(n.active<0&&(n.active=0),n.active>r.length-1&&(n.active=r.length-1)),n.border!==!1&&t.children(":first").addClass("header-no-border");if(n.width=="fit")t.outerWidth(t.parent().width());else if(n.width!="auto"){t.css("width",n.width);var s=isNaN(n.width)&&n.width.indexOf("%")!=-1;t.children(":first").outerWidth(s?"100%":n.width)}n.height=="fit"?t.outerHeight(t.parent().height()):n.height!="auto"&&t.css("height",n.height);if(n.closable&&n.tabMenu&&$.fn.omMenu){var o=t.attr("id");this.menu=this.$menu.omMenu({contextMenu:!0,dataSource:[{id:o+"_001",label:"关闭"},{id:o+"_002",label:"关闭其它"},{id:o+"_003",label:"关闭所有"}],onSelect:function(t,n){t.id==o+"_001"?e.close(e.getAlter($(e.$currentLi).find("a.om-tabs-inner").attr("tabid"))):t.id==o+"_002"?i.find("ul li").each(function(t,n){var r=$(e.$currentLi).find("a.om-tabs-inner").attr("tabid"),i=$(n).find("a.om-tabs-inner").attr("tabid");if(r===i)return;e.close(e.getAlter(i))}):t.id==o+"_003"&&e.closeAll()}})}this._renderHeader(),this._renderBody()},_renderHeader:function(){var e=this.element,t=this.options,r=this.history;$headers=e.find(">div.om-tabs-headers"),$lis=$headers.find("ul li"),$lis.addClass("om-state-default om-corner-top"),$lis.each(function(e){var i=$(this).find("a:first");s()&&i.attr("hideFocus","true"),i.addClass("om-tabs-inner"),e===t.active||t.active===i.attr("tabId")?($(this).addClass(n),t.activeTabId=i.attr("tabId"),t.active=e,$.inArray(t.activeTabId,r)||r.push(t.activeTabId)):$(this).removeClass(n),i.css({width:t.tabWidth,height:t.tabHeight}),$('<span class="lileft"></span>').insertBefore(i),t.closable===!0||$.isArray(t.closable)&&-1!==$.inArray(e,t.closable)?(i.next(".om-icon-close").length<=0&&$('<a class="om-icon om-icon-close"></a>').insertAfter(i),$('<span class="liright"></span>').insertAfter(i.next(".om-icon-close"))):(i.next().remove(),$('<span class="liright"></span>').insertAfter(i))});var i=$lis.find("a.om-tabs-inner").height();$lis.parent().css({height:++i,"line-height":i+"px"}),$headers.height(i),this._checkScroller()&&this._enableScroller()},_renderBody:function(){var e=this.element,t=this.options,n=this.items,r=e.find(">div.om-tabs-panels");r.children().detach();if(t.height!=="auto"){var i=e.innerHeight(),s=e.find(">div.om-tabs-headers").outerHeight();r.css("height",i-s)}e.toggleClass("om-tabs-noborder",!t.border);var o=n.length;while(o--)n[o].addClass("om-state-nobd").parent().prependTo(r)},_afterRender:function(){var e=this.element,t=this.options,n=this.items,r=n.length;e.children().each(function(){$(this).is(".om-tabs-headers,.om-tabs-panels")||$(this).remove()});if(!t.lazyLoad)$(n).omPanel("reload");else{var i=$(n[t.active]),s=i.omPanel("option","tabId"),o=this._getUnloadedUrl(s);i.omPanel("open"),i.omPanel("reload",o),this._removeLoadInfo(s)}while(r--){var i=$(n[r]);r==t.active?i.omPanel("open"):i.omPanel("close")}},_buildEvent:function(){var e=this,t=this.element,n=this.options,r=t.find(">div.om-tabs-headers a.om-icon-close");$(window).bind("resize",function(){var e=t.parent().innerHeight(),n=t.find(">div.om-tabs-headers").outerHeight();t.height(e),t.find(">div.om-tabs-panels").height(e-n)}),r.unbind("click.omtabs").bind("click.omtabs",function(t){var n=$(t.target).prev().attr("tabId");return e._close(n),!1});var i=t.find(">div.om-tabs-headers a.om-tabs-inner");n.switchMode.indexOf("mouseover")!=-1?i.bind("mouseover.omtabs",function(){var n=$(this).attr("tabId"),r=$.data(t,"activateTimer");typeof r!="undefined"&&clearTimeout(r),r=setTimeout(function(){return e._activate(n),!1},100),$.data(t,"activateTimer",r)}):n.switchMode.indexOf("click")!=-1&&i.bind("click.omtabs",function(){e._activate($(this).attr("tabId"))}),i.bind("click.omtabs",function(){return!1}),n.autoPlay!=0?n.autoInterId=setInterval(function(){t.omTabs("activate","next")},n.interval):clearInterval(n.autoInterId);if(n.switchMode.indexOf("mouseover")==-1){var s=t.find(">div.om-tabs-headers li"),o=function(e,t){t.is(":not(.om-state-disabled)")&&t.addClass("om-state-"+e)},u=function(e,t){t.removeClass("om-state-"+e)};s.bind("mouseover.omtabs",function(){o("hover",$(this))}),s.bind("mouseout.omtabs",function(){u("hover",$(this))}),n.closable&&n.tabMenu&&s.each(function(t,n){$(n).bind("contextmenu",function(t){$.fn.omMenu&&(e.$currentLi=this,$(e.menu).omMenu("show",t))})})}t.find(">div.om-tabs-headers >span").bind("click.omtabs",function(t){if($(this).hasClass("om-tabs-scroll-disabled"))return!1;var n=$(this).parent().find("ul").children("li:last").outerWidth(!0);return $(this).hasClass("om-tabs-scroll-left")&&e._scroll(n,e._scrollCbFn()),$(this).hasClass("om-tabs-scroll-right")&&e._scroll(-n,e._scrollCbFn()),!1})},_purgeEvent:function(){var e=this.element,t=this.options,n=e.find(">div.om-tabs-headers");n.children().unbind(".omtabs"),n.find(">ul >li >a").unbind(".omtabs"),t.autoInterId&&clearInterval(t.autoInterId)},_activate:function(e){var t=this.element,r=this.options,i=this.items,s,o=t.find(">div.om-tabs-headers ul");if(r.activeTabId===e||r.active===e)return!1;e=e||0;var u,a=e;e=="next"?e=(r.active+1)%i.length:e=="prev"&&(e=(r.active-1)%i.length),typeof e=="number"?a=this._getAlter(e):typeof e=="string"&&(e=this._getAlter(e));if(r.onBeforeActivate&&this._trigger("onBeforeActivate",null,e)===!1)return!1;u=o.find("li a[tabId="+a+"]"),u.parent().addClass(n).siblings().removeClass(n),r.activeTabId=a,r.active=e;var f=i.length;for(f=i.length;f--;f>=0){var l=i[f];if(l.omPanel("option","tabId")==a){l.omPanel("open");if(s=this._getUnloadedUrl(a))l.omPanel("reload",s),this._removeLoadInfo(a)}}for(f=i.length;f--;f>=0){var l=i[f];l.omPanel("option","tabId")!=a&&l.omPanel("close")}if(this._checkScroller()){o.stop(!0,!0),t.clearQueue();var c=o.prev(),h=o.next(),p=u.parent().offset().left,d=p+u.parent().outerWidth(!0),v=c.offset().left+c.outerWidth(!0)+4-p,m=h.offset().left-d;v>=0?this._scroll(v,this._scrollCbFn()):m<=0?this._scroll(m,this._scrollCbFn()):this._scrollCbFn()()}var g=this.history,y=$.inArray(a,g);y===-1?g.push(a):g.push(g.splice(y,1)[0]),r.onActivate&&this._trigger("onActivate",null,e)},_getUnloadedUrl:function(e){var t=this.loadInfo;for(var n in t)if(t[n].tabId===e&&t[n].loaded===!1)return t[n].url;return null},_removeLoadInfo:function(e){var t=this.loadInfo,n,r;if(t){n=t.length;while(r=t[--n])if(r.tabId===e){t.splice(n,1);break}}},_addLoadInfo:function(e,t){this.loadInfo.push({tabId:e,loaded:!1,url:t})},_getAlter:function(e){var t=this.element,n;return typeof e=="number"?n=t.find(">div.om-tabs-headers li:eq("+e+") a.om-tabs-inner").attr("tabId"):typeof e=="string"&&t.find(">div.om-tabs-headers li a.om-tabs-inner").each(function(t){if($(this).attr("tabId")==e)return n=t,!1}),n===undefined?null:n},_getActivated:function(){return this.options.activeTabId},_add:function(n){var r=this,o=this.element,u=this.options,a=this.items,f=o.find(">div.om-tabs-headers ul"),l=n.tabId?n.tabId:e+t++;n.index=n.index||"last";if(n.index=="last"||n.index>a.length-1)n.index=a.length;n.title=n.title||"New Title "+l,n.url=$.trim(n.url),n.content=$.trim(n.content),n.url?n.content=undefined:(n.url=undefined,n.content=n.content||"New Content "+l);if(u.onBeforeAdd&&r._trigger("onBeforeAdd",null,n)==0)return!1;var c=$('<li class="om-state-default om-corner-top"> </li>'),h=$('<a class="om-tabs-inner"></a>').html(n.title).attr({href:"#"+l,tabId:l}).css({width:u.tabWidth,height:u.tabHeight}).appendTo(c);$('<span class="lileft"></span>').insertBefore(h),s()&&h.attr("hideFocus","true"),n.closable===!0||n.closable==undefined&&u.closable?(h.after('<a class="om-icon om-icon-close"></a>'),$('<span class="liright"></span>').insertAfter(h.next(".om-icon-close"))):$('<span class="liright"></span>').insertAfter(h);var p={tabId:l,title:h.text(),_closeMode:"visibility",header:!1,height:"fit",closed:!0,onSuccess:function(e,t,n){r._trigger("onLoadComplete",null,l)},onError:function(e,t,n){r._trigger("onLoadComplete",null,l)}};$.extend(p,n),n.url&&(u.lazyLoad||n.lazyLoad)&&(r.loadInfo.push({tabId:l,url:n.url,loaded:!1}),p.url=null);var d=new i($("<div>"+(n.content||"")+"</div>")[0],p);n.index==a.length?(a[n.index]=d,c.insertBefore(f.find("span.right-placeholder"))):(a.splice(n.index,0,d),f.children().eq(n.index).before(c)),f.innerWidth()-c.position().left<500&&f.width(f.width()+500),this._checkScroller()&&this._enableScroller(),a[n.index].addClass("om-state-nobd").parent().insertAfter(n.index>0?o.find(">div.om-tabs-panels").children().eq(n.index-1):0),this._purgeEvent(),this._buildEvent(),this._trigger("onAdd",null,p),n.activateNew!==!1&&this._activate(n.index)},_close:function(e){var t=this.element,n=this.options,r=this.items,i=t.find(">div.om-tabs-headers"),s=t.find(">div.om-tabs-panels"),o=t.height(),u=e,a=this.history;e=e===undefined?n.active:e,typeof e=="string"?e=this._getAlter(e):u=this._getAlter(e);if(n.onBeforeClose&&this._trigger("onBeforeClose",null,e)==0)return!1;this._removeLoadInfo(this._getAlter(e)),i.find("li").eq(e).remove(),s.children().find(">.om-panel-body").eq(e).empty().remove(),r.splice(e,1),s.children().length==0&&s.css({height:o-i.outerHeight()});for(var f=a.length-1;f>=0;f--)if(u===a[f]){a.splice(f,1);break}n.onClose&&this._trigger("onClose",null,e);if(r.length==0){n.active=-1,n.activeTabId=null;return}e==n.active?(n.active=-1,this._activate(a.length>0?a.pop():0)):(e<n.active&&n.active--,this._checkScroller()&&this._enableScroller())},_closeAll:function(){var e=this.element,t=this.options,n=this.items,r=e.find(">div.om-tabs-headers"),i=e.find(">div.om-tabs-panels"),s=e.height();if(t.onBeforeCloseAll&&this._trigger("onBeforeCloseAll")===!1)return!1;for(var o=0,u=n.length;o<u;o++)this._removeLoadInfo(n[o].omPanel("option","tabId"));r.find("li").remove(),i.empty(),n.splice(0,n.length),i.css({height:s-r.outerHeight()}),t.active=-1,t.activeTabId=null,this.history=[],t.onCloseAll&&this._trigger("onCloseAll")},_checkScroller:function(){var e=this.element,t=this.options;if(!t.scrollable)return!1;var n=e.find(">div.om-tabs-headers ul"),r=4;n.children().each(function(){r+=$(this).outerWidth(!0)});if(r>n.parent().innerWidth()){if(!n.hasClass("om-tabs-scrollable")){var i=$("<span></span>").insertBefore(n).addClass("om-tabs-scroll-left"),s=$("<span></span>").insertAfter(n).addClass("om-tabs-scroll-right"),o=(n.height()-i.height())/2;n.addClass("om-tabs-scrollable")}return!0}return n.removeClass("om-tabs-scrollable").siblings().remove(),!1},_scrollCbFn:function(){var e=this;return function(){e._enableScroller()}},_enableScroller:function(){var e=this.element.find(">div.om-tabs-headers"),t=e.children("ul"),n=t.prev(),i=t.next(),s=t.children(":last"),o=e.offset().left,u=i.offset().left,a=t.offset().left,f=s.offset().left+s.outerWidth(!0);n.toggleClass(r+" om-tabs-scroll-disabled-left",a>=o),i.toggleClass(r+" om-tabs-scroll-disabled-right",f<=u)},_scroll:function(e,t){var n=this;$self=this.element,$ul=$self.find(">div.om-tabs-headers ul"),$li=$ul.children(":last");if(e==0)return;var i=e>0?$ul.prev().offset():$ul.next().offset(),s=function(s){if(e>0&&$ul.prev().hasClass(r)||e<0&&$ul.next().hasClass(r)){$ul.stop(!0,!0),$self.clearQueue();return}var o=!1;e=e>0?"+="+Math.min(i.left-$ul.offset().left,e):"-="+Math.min($li.offset().left+$li.outerWidth(!0)-i.left,Math.abs(e)),n.isScrolling=!0,$ul.animate({left:e+"px"},"normal","swing",function(){!!t&&t(),n.isScrolling=!1,s()})};$self.queue(s),$self.queue().length==1&&!n.isScrolling&&$self.dequeue()},_getLength:function(){return this.items.length},_doLayout:function(){this._checkScroller()&&this._enableScroller()},_setDataSource:function(e){var t=this.element,n=this.items,r=this.options,i=this._getAlter(e.index);e.url=$.trim(e.url),e.content=$.trim(e.content),e.url?r.lazyLoad!==!1?(this._addLoadInfo(i,e.url),n[e.index].omPanel("option","url",e.url)):(this._removeLoadInfo(i),n[e.index].omPanel("reload",e.url)):n[e.index].html(e.content)},_reload:function(e,t,n){var r=this.element,i=this.items,s=this._getAlter(e);t?(this._removeLoadInfo(s),i[e].omPanel("reload",t)):n?i[e].html(n):(i[e].omPanel("reload",this._getUnloadedUrl(s)),this._removeLoadInfo(s))}})})(jQuery);